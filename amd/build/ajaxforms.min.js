/**
 * Add a create new group modal to the page.
 *
 * @module     block_learnerscript/ajaxforms
 * @class      AjaxForms
 * @package
 * @copyright  2023 Moodle India Information Solutions Private Limited
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_learnerscript/ajaxforms",["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","block_learnerscript/ajax","block_learnerscript/schedule","block_learnerscript/select2/select2","core/yui","core/templates","core/modal","block_learnerscript/helper","jqueryui"],(function($,Str,ModalFactory,ModalEvents,Fragment,Ajax,schedule,select2,Y,Templates,Modal,helper){var AjaxForms=function(args,url){this.args=args,this.contextid=1,this.url=url,this.nodeContent=args.nodeContent||"ajaxForm",this.init(this.args)};return AjaxForms.prototype.modal=null,AjaxForms.prototype.contextid=-1,AjaxForms.prototype.init=function(args){var resp=this.getBody(),self=this,dialogueclass="";resp.done((function(data){$("body").append("<div class='"+self.nodeContent+"'></div>"),Templates.replaceNodeContents("."+self.nodeContent,data.html,"");var title_img="",position="#viewreport"+args.reportid,width="80%",my="center top",at="center top";"schreportform"==args.action?(dialogueclass="schreportform",title_img="<img class='dialog_title_icon' alt='Schedule' src='"+M.util.image_url("schreportform","block_learnerscript")+"' />",position="#inst"+args.instanceid,width="80%",my="center",at="center"):"sendreportemail"==args.action&&(dialogueclass="sendreportemail",title_img="<img class='dialog_title_icon' alt='Email' src='"+M.util.image_url("email_icon","block_learnerscript")+"'/>",position="#inst"+args.instanceid,width="80%",my="center",at="center"),$("head").append(data.javascript);var dlg=$("."+self.nodeContent).dialog({resizable:!0,autoOpen:!1,width:width,dialogClass:dialogueclass,title:self.args.title,modal:!0,appendTo:position,position:{my:my,at:at,of:position,within:position},close:function(){$(this).dialog("destroy").remove()},open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var Closebutton=$(".ui-icon-closethick").parent();Str.get_string("close","block_learnerscript").then((function(s){$(Closebutton).attr({title:s})})),$(this).closest(".ui-dialog").find(".ui-dialog-title").html(title_img+self.args.title)}});"schreportform"==args.action?($("."+self.nodeContent+" select[data-select2='1']").select2(),schedule.SelectRoleUsers()):"sendreportemail"==args.action&&require("block_learnerscript/helper").Select2Ajax({action:"userlist",reportid:args.reportid,maximumselectionlength:0}),$("."+self.nodeContent+" .mform").bind("submit",(function(e){return e.preventDefault(),self.submitFormAjax(this)})),"plotforms"!=args.action||"bar"!=args.pname&&"column"!=args.pname&&"line"!=args.pname&&"combination"!=args.pname||($("."+self.nodeContent+" select[data-select2='1']").select2({theme:"classic"}),$(document).on("click",".fa-eye",(function(e){e.stopImmediatePropagation(),$(e.target).parents(".form-group").find("*").attr("disabled",!0),$(e.target).switchClass("fa-eye","fa-eye-slash"),$(e.target).attr("title","Enable")})),$(document).on("click",".fa-eye-slash",(function(e){e.stopImmediatePropagation(),$(e.target).parents(".form-group").find("*").removeAttr("disabled"),$(e.target).switchClass("fa-eye-slash","fa-eye"),$(e.target).attr("title","Disable")})),$(document).on("change","#id_calcs",(function(){$(this).val()?($("#id_columnsort").prop("disabled",!0),$("#id_sorting").prop("disabled",!0),$("#id_limit").prop("disabled",!0)):($("#id_columnsort").prop("disabled",!1),$("#id_sorting").prop("disabled",!1),$("#id_limit").prop("disabled",!1))}))),dlg.dialog("open")})).fail((function(){}))},AjaxForms.prototype.getBody=function(formdata){return void 0===formdata?formdata=null:this.args.jsonformdata=JSON.stringify(formdata),Ajax.call({args:this.args,url:this.url},!1)},AjaxForms.prototype.handleFormSubmissionResponse=function(data){var helper=require("block_learnerscript/helper");if(data.formerror){Templates.replaceNodeContents("."+this.nodeContent,data.html,""),$("head").append(data.javascript);var self=this;$("."+this.nodeContent+" .mform").bind("submit",(function(e){e.preventDefault(),self.submitFormAjax(this)})),"schreportform"==this.args.action?($("."+self.nodeContent+" select[data-select2='1']").select2(),schedule.SelectRoleUsers()):"sendreportemail"==this.args.action?(helper=require("block_learnerscript/helper")).Select2Ajax({action:"userlist",reportid:this.args.reportid,maximumselectionlength:0}):$("."+self.nodeContent+" select[data-select2='1']").select2({theme:"classic"})}else if("columns"==this.args.component){var app=undefined.element(".simpleDemo").scope(),pluginname=this.args.advancedcolumn;app.$apply((function(){var plugindata={};plugindata.id=data.data.id,delete data.data.id,plugindata.pluginname=pluginname,plugindata.pluginfullname=pluginname,plugindata.summary="",plugindata.type="selectedcolumns",plugindata.formdata=data.data,app.lists.columns.elements.push(plugindata)})),$("."+this.nodeContent).dialog("destroy").remove()}else"schreportform"==this.args.action?($("."+this.nodeContent).dialog("close"),Str.get_string("reportschedule","block_learnerscript").then((function(s){helper.notifications(s)}))):"sendreportemail"==this.args.action?($("."+this.nodeContent).dialog("close"),Str.get_string("mailscheduled","block_learnerscript").then((function(s){helper.notifications(s)}))):window.location.reload()},AjaxForms.prototype.handleFormSubmissionFailure=function(){},AjaxForms.prototype.submitFormAjax=function(form){this.args.jsonformdata=$(form).serialize();var self=this;Ajax.call({args:this.args,url:this.url}).done((function(response){return self.handleFormSubmissionResponse(response)})).fail((function(){}))},AjaxForms.prototype.submitForm=function(e){e.preventDefault(),this.modal.getRoot().find("form").submit()},{init:function(args,url){return new AjaxForms(args,url)}}}));

//# sourceMappingURL=ajaxforms.min.js.map
