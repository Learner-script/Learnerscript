{"version":3,"file":"chart.min.js","sources":["../src/chart.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Describe different types of charts.\n *\n * @module     block_learnerscript/chart\n * @copyright  2023 Moodle India Information Solutions Private Limited\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n        'core/ajax',\n        'block_learnerscript/charts/chart',\n        'block_learnerscript/smartfilter',\n        'core/str'\n    ],\n    function($, Ajax, Chart, smartfilter, Str) {\n        /**\n         * Get highchart report for report with Ajax request\n         * @param object reportid and reportdata\n         * @return Generate highchart report\n         */\n        var chart = {\n            HighchartsAjax: function(args) {\n                args.cols = JSON.stringify(args.cols);\n                args.instanceid = args.reportid;\n                args.filters = args.filters || smartfilter.FilterData(args.instanceid);\n                args.basicparams = JSON.stringify(smartfilter.BasicparamsData(args.instanceid));\n                args.filters['lsfstartdate'] = $('#lsfstartdate').val();\n                args.filters['lsfenddate'] = $('#lsfenddate').val();\n                if (typeof args.filters['filter_courses'] == 'undefined') {\n                    var filter_courses = $('.dashboardcourses').val();\n                    if (filter_courses != 1) {\n                        args.filters['filter_courses'] = filter_courses;\n                    }\n                }\n                args.filters = JSON.stringify(args.filters);\n\n                // Request\n                var promise = Ajax.call([{\n                    methodname: 'block_learnerscript_generate_plotgraph',\n                    args: args,\n                }]);\n\n                // Preload\n                $('#report_plottabs').show();\n                $(\"#plotreportcontainer\" +\n                args.instanceid).html('<img src=\"' +\n                M.util.image_url('loading', 'block_learnerscript') + '\" id=\"reportloadingimage\" />');\n\n                // Response process\n                promise[0].done(function(response) {\n                    response = JSON.parse(response);\n                    if (response.plot) {\n                        if (response.plot.error === true) {\n                            $('.ls-report_graph_container').removeClass('hide').addClass('show');\n                            $('.ls-report_graph_container').css('height', '100px');\n                            Str.get_string('nodataavailable', 'block_learnerscript').then(function(s) {\n                                $('#plotreportcontainer' +\n                                args.instanceid).html(\"<div class='alert alert-warning'>\" + s + \"</div>\");\n                            });\n                            $(document).ajaxStop(function() {\n                                $(\"#reportloadingimage\").remove();\n                            });\n                        } else {\n                            response.plot.reportid = args.reportid;\n                            response.plot.reportinstance = args.reportid;\n                            if (response.plot.data && response.plot.data.length > 0) {\n                                $('.ls-report_graph_container').removeClass('hide').addClass('show');\n                                $('#plotreportcontainer' + args.instanceid).css('height', '500px');\n                                require(['block_learnerscript/report'], function(report) {\n                                    report.generate_plotgraph(response.plot);\n                                });\n                                $(document).ajaxStop(function() {\n                                    $(\"#reportloadingimage\").remove();\n                                });\n                            } else {\n                                $(\"#plotreportcontainer\" + args.instanceid).css('height', '100px');\n                                Str.get_string('nodataavailable', 'block_learnerscript').then(function(s) {\n                                    $('#plotreportcontainer' +\n                                    args.instanceid).html(\"<div class='alert alert-warning'>\" + s + \"</div>\");\n                                });\n                                $(document).ajaxStop(function() {\n                                    $(\"#reportloadingimage\").remove();\n                                });\n                            }\n                        }\n                    }\n                });\n            },\n            combinationchart: function(chartdata) {\n                var canvas = document.createElement('canvas');\n\n                canvas.id = \"mixedcanvas\";\n                canvas.style.width = \"100%\";\n                canvas.style.height = \"500px\";\n                canvas.style.zIndex = 8;\n                canvas.style.position = \"absolute\";\n                var body = document.getElementById(chartdata.containerid);\n                body.appendChild(canvas);\n                var cursorlayer = document.getElementById(\"mixedcanvas\").getContext(\"2d\");\n                new Chart(cursorlayer, {\n                    type: 'bar',\n                    data: {\n                        datasets: chartdata.data,\n                        labels: chartdata.categorydata\n                    }//end data\n                });\n            },\n            lbchart: function(chartdata) {\n                var canvas = document.createElement('canvas');\n                canvas.id = \"canvaschart\";\n                canvas.style.width = \"100%\";\n                canvas.style.height = \"500px\";\n                canvas.style.zIndex = 8;\n                canvas.style.position = \"absolute\";\n                var body = document.getElementById(chartdata.containerid);\n                body.appendChild(canvas);\n                var cursorlayer = document.getElementById(\"canvaschart\").getContext(\"2d\");\n                new Chart(cursorlayer, {\n                    type: 'bar',\n                    data: {\n                        datasets: chartdata.data,\n                        labels: chartdata.categorydata\n                    }//end data\n                });\n            },\n        };\n        return chart;\n    });\n"],"names":["define","$","Ajax","Chart","smartfilter","Str","HighchartsAjax","args","cols","JSON","stringify","instanceid","reportid","filters","FilterData","basicparams","BasicparamsData","val","filter_courses","promise","call","methodname","show","html","M","util","image_url","done","response","parse","plot","error","removeClass","addClass","css","get_string","then","s","document","ajaxStop","remove","reportinstance","data","length","require","report","generate_plotgraph","combinationchart","chartdata","canvas","createElement","id","style","width","height","zIndex","position","getElementById","containerid","appendChild","cursorlayer","getContext","type","datasets","labels","categorydata","lbchart"],"mappings":"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"}